---
import AdminLayout from '../../layouts/AdminLayout.astro';
import { getTags } from '../../utils/api';
---

<AdminLayout pageTitle="Manage Tags">
  <div class="space-y-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Tags</h1>
      <p class="text-gray-600 mt-2">Manage tags for organizing your content</p>
    </div>

    <!-- Create Tag Section -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">Create Tag</h2>
      <form id="create-tag-form" class="space-y-4">
        <div>
          <label for="tag-name" class="block text-sm font-medium text-gray-700 mb-2">
            Tag Name
          </label>
          <input
            type="text"
            id="tag-name"
            name="name"
            placeholder="e.g., Photography, Tutorial"
            required
            class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
          />
        </div>

        <button
          type="submit"
          class="px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-medium"
        >
          Create Tag
        </button>
      </form>
    </div>

    <!-- Tags List -->
    <div id="tags-container" class="space-y-4">
      <!-- Tags will be loaded here -->
    </div>
  </div>

  <script>
    const form = document.getElementById('create-tag-form') as HTMLFormElement;
    const container = document.getElementById('tags-container');

    // Load tags
    async function loadTags() {
      const result = await (await import('../../utils/api')).getTags();
      const tags = result.success ? result.data || [] : [];

      if (!container) return;

      if (tags.length === 0) {
        container.innerHTML = `
          <div class="bg-white rounded-lg shadow-md p-12 text-center">
            <p class="text-gray-500">No tags yet. Create your first tag above.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-lg font-bold text-gray-900 mb-4">Existing Tags (${tags.length})</h2>
          <div class="flex flex-wrap gap-2">
            ${tags.map(tag => `
              <div class="inline-flex items-center gap-2 px-3 py-1 bg-gray-100 rounded-full">
                <span class="text-sm font-medium text-gray-900">${tag.name}</span>
                <button
                  type="button"
                  onclick="deleteTag(${JSON.stringify(tag.id)})"
                  class="text-gray-500 hover:text-gray-900"
                >
                  âœ•
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // Delete tag function
    (window as any).deleteTag = async function(id: string) {
      // Note: Implement delete endpoint in API
      console.log('Delete tag:', id);
    };

    // Handle create
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const nameInput = document.getElementById('tag-name') as HTMLInputElement;
        const name = nameInput.value;

        if (!name) return;

        // Note: Implement create endpoint in API
        console.log('Create tag:', name);
        nameInput.value = '';
        loadTags();
      });
    }

    // Initial load
    loadTags();
  </script>
</AdminLayout>
